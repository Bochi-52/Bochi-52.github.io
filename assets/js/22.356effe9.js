(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{426:function(s,a,t){"use strict";t.r(a);var n=t(2),r=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("blockquote",[a("p",[s._v("副本集：自动故障转移 主从复制 集群")]),s._v(" "),a("ul",[a("li",[s._v("解决问题：1.数据冗余备份 2.架构高可用")]),s._v(" "),a("li",[s._v("不能解决：单节点压力问题(硬件限制 并发访问压力)")])])]),s._v(" "),a("blockquote",[a("p",[s._v("垂直扩容（Scale Up） VS 水平扩容（Scale Out）：\n垂直扩容 ： 用更好的服务器，提高 CPU 处理核数、内存数、带宽等\n水平扩容 ： 将任务分配到多台计算机上")])]),s._v(" "),a("blockquote",[a("p",[s._v("什么是 MongoDB 分片集群：\nMongoDB 分片集群（Sharded Cluster）是对数据进行水平扩展的一种方法\n使用 分片集群 来支持大数据集和高吞吐量的业务场景。\nMongoDB 支持自动分片，集群自动切分数据做负载均衡。")])]),s._v(" "),a("h4",{attrs:{id:"分片集群的基本架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分片集群的基本架构"}},[s._v("#")]),s._v(" 分片集群的基本架构")]),s._v(" "),a("blockquote",[a("ul",[a("li",[s._v("Mongos\n分片集群的访问入口\n对请求进行路由、分发、合并\n部署多个 Mongos 来保证高可用")]),s._v(" "),a("li",[s._v("ConfigServer\n存储元信息和集群配置\n部署为"),a("code",[s._v("副本集")]),s._v("来保证高可用")]),s._v(" "),a("li",[s._v("Shard\n存储用户数据，不同 Shard 保存不同用户数据\n可以 部署为"),a("code",[s._v("副本集")]),s._v("来保证高可用\n依据\n"),a("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/27770120-0041c272588d9c58.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:""}}),s._v(" "),a("code",[s._v("片键")]),s._v(":设置分片时需要在集合选取一个键，用该键的值作为拆分数据的依据\n片键的决定了数据散列是否均匀。")])])]),s._v(" "),a("h1",{attrs:{id:"分片集群搭建-模拟"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分片集群搭建-模拟"}},[s._v("#")]),s._v(" 分片集群搭建(模拟)")]),s._v(" "),a("blockquote",[a("p",[s._v("建议localhost写成具体IP")])]),s._v(" "),a("h3",{attrs:{id:"_1-集群规划"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-集群规划"}},[s._v("#")]),s._v(" 1.集群规划")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("- Shard Server "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27017")]),s._v("\n- Shard Repl "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27018")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Shard Server 1的副本集节点，用作备份")]),s._v("\n\n- Shard Server "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27019")]),s._v("\n- Shard Repl "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27020")]),s._v("\n\n- Shard Server "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27021")]),s._v("\n- Shard Repl "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27022")]),s._v("\n\n- Config Server "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27023")]),s._v("\n- Config Server "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27024")]),s._v("\n- Config Server "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27025")]),s._v("\n\n- Route Rrocess "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27026")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"_2-进入安装的bin目录-mongodb-bin-创建数据目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-进入安装的bin目录-mongodb-bin-创建数据目录"}},[s._v("#")]),s._v(" 2.进入安装的bin目录(~/mongodb/bin)创建数据目录")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分片")]),s._v("\n- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cluster/shard/s0\n- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cluster/shard/s0-repl\n\n- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cluster/shard/s1\n- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cluster/shard/s1-repl\n\n- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cluster/shard/s2\n- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cluster/shard/s2-repl\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置服务器")]),s._v("\n- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cluster/shard/config1\n- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cluster/shard/config2\n- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cluster/shard/config3\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查")]),s._v("\n- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cluster/shard/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h3",{attrs:{id:"_3-启动4个shard服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-启动4个shard服务"}},[s._v("#")]),s._v(" 3.启动4个shard服务")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动s0、r0,并初始化")]),s._v("\n- ./mongo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27017")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dbpath")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cluster/shard/s0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--bind_ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--shardsvr")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replSet")]),s._v(" r0/localhost:27018\n- ./mongo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27018")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dbpath")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cluster/shard/s0-repl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--bind_ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--shardsvr")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replSet")]),s._v(" r0/localhost:27017\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#登录任意客户端节点，连接任意节点")]),s._v("\n- "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" mongodb/bin \n- ./mongo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27017")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#初始化")]),s._v("\n- use admin\n- var config "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        _id:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"r0"')]),s._v(",\n        members:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_id:0,host:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:27017"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_id:1,host:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:27018"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n- rs.initiate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#初始化配置")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动s1、r1,并初始化")]),s._v("\n- ./mongo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27019")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dbpath")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cluster/shard/s1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--bind_ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--shardsvr")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replSet")]),s._v(" r1/localhost:27020\n- ./mongo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27020")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dbpath")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cluster/shard/s1-repl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--bind_ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--shardsvr")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replSet")]),s._v(" r1/localhost:27019\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#登录任意客户端节点，连接任意节点")]),s._v("\n- "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" mongodb/bin \n- ./mongo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27019")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#初始化")]),s._v("\n- use admin\n- var config "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        _id:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"r1"')]),s._v(",\n        members:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_id:0,host:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:27019"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_id:1,host:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:27020"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n- rs.initiate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#初始化配置")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动s2、r2,并初始化")]),s._v("\n- ./mongo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27021")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dbpath")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cluster/shard/s1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--bind_ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--shardsvr")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replSet")]),s._v(" r2/localhost:27022\n- ./mongo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27022")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dbpath")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cluster/shard/s1-repl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--bind_ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--shardsvr")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replSet")]),s._v(" r2/localhost:27021\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#登录任意客户端节点，连接任意节点")]),s._v("\n- "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" mongodb/bin \n- ./mongo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27021")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#初始化")]),s._v("\n- use admin\n- var config "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        _id:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"r2"')]),s._v(",\n        members:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_id:0,host:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:27021"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_id:1,host:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:27022"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n- rs.initiate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#初始化配置")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动Config Servers")]),s._v("\n- ./mongo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27023")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dbpath")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cluster/shard/config "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--bind_ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replSet")]),s._v(" config /"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("localhost:27024,localhost:27025"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--configsvr")]),s._v("\n- ./mongo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27024")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dbpath")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cluster/shard/config "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--bind_ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replSet")]),s._v(" config /"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("localhost:27023,localhost:27025"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--configsvr")]),s._v("\n- ./mongo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27025")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dbpath")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cluster/shard/config "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--bind_ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replSet")]),s._v(" config /"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("localhost:27023,localhost:27024"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--configsvr")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#登录任意客户端节点，连接任意节点")]),s._v("\n- "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" mongodb/bin \n- ./mongo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27023")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#初始化")]),s._v("\n- use admin\n- var config "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        _id:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"config "')]),s._v(",\n        configsvr:true,\n        members:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_id:0,host:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:27023"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_id:1,host:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:27024"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_id:2,host:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:27025"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n- rs.initiate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动mongos路由")]),s._v("\n- ./mongo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27026")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--configdb")]),s._v(" config/localhost:27023,localhost:27024,localhost:27025 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--bind_ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录 mongos 服务")]),s._v("\n- "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" mongodb/bin \n- ./mongo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27026")]),s._v("\n- use admin\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加分片信息")]),s._v("\n- db.runCommand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" addshard:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"r0/localhost:27017,localhost:27018"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"allowLocal"')]),s._v(":true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n- db.runCommand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" addshard:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"r1/localhost:27019,localhost:27020"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"allowLocal"')]),s._v(":true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n- db.runCommand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" addshard:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"r2/localhost:27021,localhost:27022"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"allowLocal"')]),s._v(":true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h5",{attrs:{id:"建好了-测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#建好了-测试"}},[s._v("#")]),s._v(" 建好了，测试")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录 mongos 服务")]),s._v("\n- "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" mongodb/bin \n- ./mongo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27026")]),s._v("\n- use admin\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定分片的数据库")]),s._v("\n- db.runCommand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" enablesharding:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"testDatabase"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置库的片键信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用id为片键")]),s._v("\n- db.runCommand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" shardcollection:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"testDatabase.users"')]),s._v(",key:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_id:1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用id为片键，使用散列，分布更均匀")]),s._v("\n- db.runCommand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" shardcollection:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"testDatabase.users"')]),s._v(",key:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_id:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hashed"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);