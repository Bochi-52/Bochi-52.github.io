(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{427:function(a,s,t){"use strict";t.r(s);var n=t(2),e=Object(n.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("blockquote",[s("p",[a._v("MongoDB复制是将数据同步在多个服务器的过程。\n复制提供了数据的冗余备份，并在多个服务器上存储数据副本，提高了数据的可用性， 并可以保证数据的安全性。\n复制还允许您从硬件故障和服务中断中恢复数据。")])]),a._v(" "),s("blockquote",[s("p",[a._v("mongodb的复制至少需要两个节点。其中一个是主节点，负责处理客户端请求，其余的都是从节点，负责复制主节点上的数据。\nmongodb各个节点常见的搭配方式为：一主一从、一主多从。\n主节点记录在其上的所有操作oplog，从节点定期轮询主节点获取这些操作，然后对自己的数据副本执行\n这些操作，从而保证从节点的数据与主节点一致。")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/27770120-ee69a6264e19d542.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"MongoDB复制结构图"}})]),a._v(" "),s("blockquote",[s("p",[a._v("具有 自动故障转移机制\nMongoDB副本集在主从复制基础上实现了故障转移的功能，也就是当主节点宕机时，某一台副本节点会自动提升为新主节点。")])]),a._v(" "),s("blockquote",[s("p",[a._v("缺陷\n所有读写都在主节点，不能解决主节点单点压力问题")])]),a._v(" "),s("h1",{attrs:{id:"搭建副本集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#搭建副本集"}},[a._v("#")]),a._v(" 搭建副本集")]),a._v(" "),s("blockquote",[s("p",[a._v("至少两个节点以上，一般时奇数个，3台、5台、7台……")])]),a._v(" "),s("h2",{attrs:{id:"_1-创建数据目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建数据目录"}},[a._v("#")]),a._v(" 1. 创建数据目录")]),a._v(" "),s("div",{staticClass:"language-markdown line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-markdown"}},[s("code",[s("span",{pre:!0,attrs:{class:"token title important"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("#")]),a._v(" 在安装目录(~/mongodb/bin)中创建")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token list punctuation"}},[a._v("-")]),a._v(" mkdir -p ../repl/data1\n"),s("span",{pre:!0,attrs:{class:"token list punctuation"}},[a._v("-")]),a._v(" mkdir -p ../repl/data2\n"),s("span",{pre:!0,attrs:{class:"token list punctuation"}},[a._v("-")]),a._v(" mkdir -p ../repl/data3\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h2",{attrs:{id:"_2-搭建副本集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-搭建副本集"}},[a._v("#")]),a._v(" 2. 搭建副本集")]),a._v(" "),s("blockquote",[s("p",[a._v("建议localhost写成具体IP")])]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 在多个命令行窗口分别启用")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 一个副本集的多个MongoDB进程，要在同一副本集中名字相同(myReplaceName)")]),a._v("\n\n$ mongo "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("27017")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dbpath")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("/repl/data1 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--bind_ip")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--replSet")]),a._v(" myReplaceName/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("localhost:27018,localhost:27019"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n$ mongo "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("27018")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dbpath")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("/repl/data2 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--bind_ip")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--replSet")]),a._v(" myReplaceName/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("localhost:27017,localhost:27019"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n$ mongo "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("27019")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dbpath")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("/repl/data3 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--bind_ip")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--replSet")]),a._v(" myReplaceName/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("localhost:27017,localhost:27018"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# --replSet 副本集 myReplace 副本集名称/集群中其他节点的主机端口")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("h2",{attrs:{id:"_3-配置副本集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置副本集"}},[a._v("#")]),a._v(" 3. 配置副本集")]),a._v(" "),s("blockquote",[s("p",[a._v("不初始化不能进行选举")])]),a._v(" "),s("h3",{attrs:{id:"_3-1-登录任意客户端节点-连接任意节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-登录任意客户端节点-连接任意节点"}},[a._v("#")]),a._v(" 3.1 登录任意客户端节点，连接任意节点")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" mongodb/bin\n$ ./mongo "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("27017")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h3",{attrs:{id:"_3-2-初始化副本集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-初始化副本集"}},[a._v("#")]),a._v(" 3.2 初始化副本集")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" use admin\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" var config "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        _id:"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"myReplaceName"')]),a._v(",\n        members:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("_id:0,host:"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"localhost:27017"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(",\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("_id:1,host:"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"localhost:27018"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(",\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("_id:2,host:"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"localhost:27019"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" rs.initiate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#初始化配置")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("#从节点是无法读的\n> rs.slaveOk();  \n> rs.secondaryOk()  #允许客户端临时访问\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("h1",{attrs:{id:"客户端使用副本集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端使用副本集"}},[a._v("#")]),a._v(" 客户端使用副本集")]),a._v(" "),s("blockquote",[s("p",[a._v("SpringBoot应用程序中")])]),a._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mongodb")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" mongodb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//192.168.0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("27017")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("192.168.0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("27018")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("192.168.0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("27019/databaseName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("?")]),a._v("replicaSet=myReplaceName\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#语法：")]),a._v("\nmongodb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("username"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("password@"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("host1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("port1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("host2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("port2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("...")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("hostN"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("portN"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("database"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("?")]),a._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);